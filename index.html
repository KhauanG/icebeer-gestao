<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Sistema de controle de vendas Ice Beer v4.0 - Firebase integrado">
    <title>üç∫ Ice Beer - Sistema de Vendas v4.0</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ice Beer">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iNDAiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSIxOTIiIHkyPSIxOTIiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzY2N2VlYSIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM3NjRiYTIiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8cGF0aCBkPSJNNDggNzJDNDggNjMuMTYzNCA1NS4xNjM0IDU2IDY0IDU2SDEyOEMxMzYuODM3IDU2IDE0NCA2My4xNjM0IDE0NCA3MlYxMjBDMTQ0IDEyOC44MzcgMTM2LjgzNyAxMzYgMTI4IDEzNkg2NEM1NS4xNjM0IDEzNiA0OCAxMjguODM3IDQ4IDEyMFY3MloiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9Ijk2IiB5PSIxMDQiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI0OCIgZmlsbD0iIzY2N2VlYSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9IjAuM2VtIj7wn4+6PC90ZXh0Pgo8L3N2Zz4K">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzIiIGhlaWdodD0iNzIiIHZpZXdCb3g9IjAgMCA3MiA3MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjcyIiBoZWlnaHQ9IjcyIiByeD0iMTYiIGZpbGw9InVybCgjZ3JhZGllbnQwX2xpbmVhcl8xXzEpIi8+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50MF9saW5lYXJfMV8xIiB4MT0iMCIgeTE9IjAiIHgyPSI3MiIgeTI9IjcyIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiM2NjdlZWEiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjNzY0YmEyIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHBhdGggZD0iTTIwIDI4QzIwIDI0LjY4NjMgMjIuNjg2MyAyMiAyNiAyMkg0NkM0OS4zMTM3IDIyIDUyIDI0LjY4NjMgNTIgMjhWNDRDNTIgNDcuMzEzNyA0OS4zMTM3IDUwIDQ2IDUwSDI2QzIyLjY4NjMgNTAgMjAgNDcuMzEzNyAyMCA0NFYyOFoiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9IjM2IiB5PSI0MCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiBmaWxsPSIjNjY3ZWVhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iMC4zZW0iPvCfj7o8L3RleHQ+Cjwvc3ZnPgo=">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js" as="script">
    <link rel="prefetch" href="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com https://www.gstatic.com https://*.googleapis.com https://*.firebaseapp.com; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://www.gstatic.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:;">
</head>
<body>
    <!-- Progress Indicator -->
    <div id="progressIndicator" class="progress-indicator">
        <div id="progressBar" class="progress-indicator-bar"></div>
    </div>

    <!-- Status Indicators -->
    <div class="status-indicators">
        <div id="firebaseStatus" class="status-indicator show">üî• Conectando Firebase...</div>
        <div id="cacheStatus" class="status-indicator show">üíæ Inicializando Cache...</div>
        <div id="pwStatus" class="status-indicator show">üì± Configurando PWA...</div>
    </div>

    <!-- Performance Indicator -->
    <div id="performanceIndicator" class="performance-indicator">‚ö° Carregando...</div>

    <!-- Cache Status -->
    <div id="cacheStatusDisplay" class="cache-status" onclick="showCacheStats()">
        üíæ Cache: Carregando...
    </div>

    <div class="container">
        <!-- Login Screen -->
        <div id="loginScreen" class="card">
            <div class="header">
                <h1>üç∫ Ice Beer</h1>
                <p>Sistema de Controle de Vendas</p>
                <div class="version-badge">v4.0</div>
            </div>
            
            <div class="login-form">
                <div id="loginAlert" class="alert alert-error hidden"></div>
                
                <div class="form-group">
                    <label for="email">E-mail:</label>
                    <input type="email" id="email" placeholder="seu@email.com" required autocomplete="email">
                </div>
                
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" placeholder="Sua senha" required autocomplete="current-password">
                </div>
                
                <button id="loginBtn" onclick="handleLogin()">
                    <span id="loginText">Entrar</span>
                    <span id="loginLoading" class="loading hidden"></span>
                </button>
                
                <div class="login-help">
                    <small>Usu√°rios autorizados: conveniencias@icebeer.com, petiscarias@icebeer.com, diskchopp@icebeer.com, executivo@icebeer.com</small>
                </div>
            </div>
        </div>

        <!-- Dashboard Principal -->
        <div id="dashboard" class="dashboard">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="user-info">
                    <h2 id="welcomeText">Carregando...</h2>
                    <span id="currentDate"></span>
                </div>
                <div class="top-controls">
                    <select id="monthYearSelect" onchange="handleUpdateDashboard()" aria-label="Selecionar m√™s/ano">
                        <option value="">Carregando...</option>
                    </select>
                    <button class="logout-btn" onclick="handleLogout()" aria-label="Fazer logout">Sair</button>
                </div>
            </div>

            <!-- Filtros Avan√ßados -->
            <div class="filters-panel">
                <div class="filters-title">
                    üìä Filtros Avan√ßados
                    <span class="tooltip" data-tooltip="Use os filtros para an√°lises personalizadas">‚ÑπÔ∏è</span>
                </div>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="filterSegment">Segmento:</label>
                        <select id="filterSegment" onchange="handleSegmentChange()" aria-label="Filtrar por segmento">
                            <option value="">Todos os segmentos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterStore">Loja:</label>
                        <select id="filterStore" onchange="handleStoreChange()" aria-label="Filtrar por loja">
                            <option value="">Todas as lojas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterMonth">M√™s/Ano:</label>
                        <select id="filterMonth" onchange="handleMonthChange()" aria-label="Filtrar por m√™s">
                            <option value="">Selecione um m√™s</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterPeriod">Per√≠odo:</label>
                        <select id="filterPeriod" onchange="handlePeriodChange()" aria-label="Filtrar por per√≠odo">
                            <option value="">Todo o m√™s</option>
                            <option value="week">Por semana</option>
                            <option value="range">Per√≠odo personalizado</option>
                        </select>
                    </div>
                </div>

                <!-- Filtros de Data Personalizados -->
                <div id="customDateRange" class="custom-date-range hidden">
                    <div class="date-inputs">
                        <div class="form-group">
                            <label for="startDate">Data In√≠cio:</label>
                            <input type="date" id="startDate" onchange="handleDateRangeChange()" aria-label="Data de in√≠cio">
                        </div>
                        <div class="form-group">
                            <label for="endDate">Data Fim:</label>
                            <input type="date" id="endDate" onchange="handleDateRangeChange()" aria-label="Data de fim">
                        </div>
                    </div>
                </div>

                <!-- Filtro de Semanas -->
                <div id="weekFilter" class="week-filter hidden">
                    <div class="form-group">
                        <label for="filterWeek">Semana:</label>
                        <select id="filterWeek" onchange="handleWeekChange()" aria-label="Filtrar por semana">
                            <option value="">Todas as semanas</option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                    <button class="analyze-btn" id="analyzeBtn" onclick="handleAnalyze()">
                        <span id="analyzeText">üìà Analisar</span>
                        <span id="analyzeLoading" class="loading hidden"></span>
                    </button>
                    <button class="analyze-btn secondary" onclick="clearFilters()">
                        üîÑ Limpar Filtros
                    </button>
                </div>
            </div>

            <!-- Estat√≠sticas Principais -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">R$ 0,00</div>
                    <div class="stat-label">Faturamento Total</div>
                    <div class="stat-subtitle" id="revenueInfo">Per√≠odo selecionado</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="averageDaily">R$ 0,00</div>
                    <div class="stat-label">M√©dia Di√°ria</div>
                    <div class="stat-subtitle" id="dailyInfo">Baseada no per√≠odo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="projectionMonthly">R$ 0,00</div>
                    <div class="stat-label">Proje√ß√£o Mensal</div>
                    <div class="stat-subtitle" id="projectionInfo">Com base na m√©dia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="goalProgress">0%</div>
                    <div class="stat-label">% da Meta</div>
                    <div class="stat-subtitle" id="goalInfo">Meta vs Realizado</div>
                </div>
            </div>

            <!-- A√ß√µes R√°pidas -->
            <div class="card">
                <h3 class="section-title">üõ†Ô∏è A√ß√µes e Relat√≥rios</h3>
                <div class="action-buttons">
                    <button class="action-btn" onclick="generateDetailedReport()">
                        üìÑ Relat√≥rio Detalhado
                    </button>
                    <button class="action-btn secondary" onclick="exportToExcel()">
                        üìä Exportar Excel
                    </button>
                    <button class="action-btn" onclick="showChartsModal()">
                        üìà Gr√°ficos Avan√ßados
                    </button>
                    <button class="action-btn secondary" onclick="backupData()">
                        üíæ Backup
                    </button>
                    <button class="action-btn" onclick="runSystemDiagnostic()">
                        üß™ Diagn√≥stico
                    </button>
                </div>
            </div>

            <!-- Formul√°rios -->
            <div class="forms-section">
                <!-- Lan√ßamento de Vendas -->
                <div class="card">
                    <h3 class="section-title">üìä Lan√ßar Vendas</h3>
                    <div id="entryAlert" class="alert alert-success hidden"></div>
                    
                    <div class="form-group">
                        <label for="storeSelect">Loja:</label>
                        <select id="storeSelect" required aria-label="Selecionar loja">
                            <option value="">Selecione uma loja</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="entryType">Tipo de Lan√ßamento:</label>
                        <select id="entryType" onchange="handleEntryTypeChange()" required aria-label="Tipo de lan√ßamento">
                            <option value="single">Dia espec√≠fico</option>
                            <option value="period">Per√≠odo (m√∫ltiplos dias)</option>
                            <option value="week">Semana completa</option>
                        </select>
                    </div>

                    <!-- Campos de data flex√≠veis -->
                    <div id="singleDateField" class="form-group">
                        <label for="singleDate">Data:</label>
                        <input type="date" id="singleDate" onchange="previewTargetMonth()" aria-label="Data do lan√ßamento">
                    </div>

                    <div id="periodFields" class="period-fields hidden">
                        <div class="form-group">
                            <label for="periodStart">Data In√≠cio:</label>
                            <input type="date" id="periodStart" onchange="previewTargetMonth()" aria-label="Data de in√≠cio do per√≠odo">
                        </div>
                        <div class="form-group">
                            <label for="periodEnd">Data Fim:</label>
                            <input type="date" id="periodEnd" onchange="previewTargetMonth()" aria-label="Data de fim do per√≠odo">
                        </div>
                    </div>
                    
                    <div id="monthPreview" class="month-preview hidden">
                        <span id="monthPreviewText"></span>
                    </div>
                    
                    <div class="form-group">
                        <label for="entryValue">Faturamento (R$):</label>
                        <input type="number" id="entryValue" placeholder="0,00" step="0.01" min="0" max="1000000" required aria-label="Valor do faturamento">
                    </div>
                    
                    <div class="form-group">
                        <label for="entryNotes">Observa√ß√µes (opcional):</label>
                        <textarea id="entryNotes" placeholder="Adicione observa√ß√µes sobre este lan√ßamento" rows="3" aria-label="Observa√ß√µes do lan√ßamento"></textarea>
                    </div>
                    
                    <button id="entryBtn" onclick="handleSubmitSales()">
                        <span id="entryText">Lan√ßar Vendas</span>
                        <span id="entryLoading" class="loading hidden"></span>
                    </button>
                    
                    <div id="editMode" class="edit-mode hidden">
                        <p>üîÑ Modo de Edi√ß√£o Ativo</p>
                        <button onclick="handleCancelEdit()" class="cancel-btn">Cancelar Edi√ß√£o</button>
                    </div>
                </div>

                <!-- Definir Metas -->
                <div class="card">
                    <h3 class="section-title">üéØ Definir Meta</h3>
                    <div id="targetAlert" class="alert alert-success hidden"></div>
                    
                    <div class="form-group">
                        <label for="targetStoreSelect">Loja:</label>
                        <select id="targetStoreSelect" required aria-label="Selecionar loja para meta">
                            <option value="">Selecione uma loja</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="targetType">Tipo de Meta:</label>
                        <select id="targetType" onchange="handleTargetTypeChange()" required aria-label="Tipo de meta">
                            <option value="monthly">Meta Mensal</option>
                            <option value="weekly">Meta Semanal</option>
                            <option value="daily">Meta Di√°ria</option>
                        </select>
                    </div>

                    <div id="targetDateField" class="form-group hidden">
                        <label for="targetDate">Data/Per√≠odo:</label>
                        <input type="date" id="targetDate" aria-label="Data da meta">
                    </div>
                    
                    <div class="form-group">
                        <label for="targetValue">Valor da Meta (R$):</label>
                        <input type="number" id="targetValue" placeholder="0,00" step="0.01" min="0" max="10000000" required aria-label="Valor da meta">
                    </div>
                    
                    <button id="targetBtn" onclick="handleSetTarget()">
                        <span id="targetText">Salvar Meta</span>
                        <span id="targetLoading" class="loading hidden"></span>
                    </button>
                </div>
            </div>

            <!-- Tabela de Resultados -->
            <div class="card">
                <h3 class="section-title">üìà Resultados - <span id="selectedPeriodDisplay">Per√≠odo Atual</span></h3>
                
                <!-- Controles da Tabela -->
                <div class="table-controls">
                    <div class="view-options" role="tablist">
                        <button class="view-btn active" onclick="switchView('stores')" id="storesViewBtn" role="tab" aria-selected="true">Por Loja</button>
                        <button class="view-btn" onclick="switchView('timeline')" id="timelineViewBtn" role="tab" aria-selected="false">Timeline</button>
                        <button class="view-btn" onclick="switchView('comparison')" id="comparisonViewBtn" role="tab" aria-selected="false">Comparativo</button>
                    </div>
                    <div class="table-actions">
                        <button class="btn-small" onclick="exportTableData()">üìä Exportar</button>
                        <button class="btn-small" onclick="refreshTableData()">üîÑ Atualizar</button>
                    </div>
                </div>

                <!-- Tabela por Lojas -->
                <div id="storesView" class="table-view" role="tabpanel">
                    <table class="data-table" role="table">
                        <thead>
                            <tr>
                                <th scope="col">Loja</th>
                                <th scope="col">Faturamento</th>
                                <th scope="col">Meta</th>
                                <th scope="col">% Atingido</th>
                                <th scope="col">M√©dia Di√°ria</th>
                                <th scope="col">Lan√ßamentos</th>
                                <th scope="col">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="storesTableBody">
                            <tr>
                                <td colspan="7" class="loading-row">Carregando dados...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Timeline de Lan√ßamentos -->
                <div id="timelineView" class="table-view hidden" role="tabpanel">
                    <table class="data-table" role="table">
                        <thead>
                            <tr>
                                <th scope="col">Data</th>
                                <th scope="col">Loja</th>
                                <th scope="col">Per√≠odo</th>
                                <th scope="col">Valor</th>
                                <th scope="col">Tipo</th>
                                <th scope="col">Observa√ß√µes</th>
                                <th scope="col">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="timelineTableBody">
                            <tr>
                                <td colspan="7" class="loading-row">Carregando timeline...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Vista Comparativa -->
                <div id="comparisonView" class="table-view hidden" role="tabpanel">
                    <div class="comparison-charts">
                        <div class="chart-container">
                            <canvas id="comparisonChart" aria-label="Gr√°fico comparativo de vendas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifica√ß√µes -->
    <div id="notification" class="notification" role="alert" aria-live="polite">
        <button class="notification-close" onclick="closeNotification()" aria-label="Fechar notifica√ß√£o">&times;</button>
        <div class="notification-title" id="notificationTitle">T√≠tulo</div>
        <div class="notification-message" id="notificationMessage">Mensagem</div>
    </div>

    <!-- Modal para Gr√°ficos -->
    <div id="chartsModal" class="modal-overlay" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">üìä An√°lise Detalhada</h3>
                <button class="modal-close" onclick="closeChartsModal()" aria-label="Fechar modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="charts-container">
                    <div class="chart-section">
                        <h4>Evolu√ß√£o Temporal</h4>
                        <canvas id="timelineChart" aria-label="Gr√°fico de evolu√ß√£o temporal"></canvas>
                    </div>
                    <div class="chart-section">
                        <h4>Performance por Loja</h4>
                        <canvas id="performanceChart" aria-label="Gr√°fico de performance por loja"></canvas>
                    </div>
                    <div class="chart-section">
                        <h4>Metas vs Realizado</h4>
                        <canvas id="goalsChart" aria-label="Gr√°fico de metas vs realizado"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Install Prompt -->
    <div id="installPrompt" class="install-prompt">
        <div>
            <strong>üç∫ Instalar Ice Beer</strong><br>
            <small>Acesse rapidamente do seu dispositivo!</small>
        </div>
        <button onclick="installPWA()">Instalar</button>
        <button onclick="dismissInstallPrompt()">Agora n√£o</button>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>

    <!-- Main Script -->
    <script type="module" src="script.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('‚úÖ SW registered: ', registration);
                        
                        // Update available
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Show update notification
                                    if (window.notificationManager) {
                                        window.notificationManager.show(
                                            'Nova vers√£o dispon√≠vel!', 
                                            'Recarregue a p√°gina para usar a vers√£o mais recente', 
                                            'info', 
                                            10000
                                        );
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('‚ùå SW registration failed: ', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('show');
        });

        window.installPWA = async function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`PWA install ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.remove('show');
            }
        };

        window.dismissInstallPrompt = function() {
            document.getElementById('installPrompt').classList.remove('show');
            deferredPrompt = null;
        };

        // Add system diagnostic function
        window.runSystemDiagnostic = function() {
            if (window.fbTest) {
                window.fbTest.runFullDiagnostic();
            } else {
                console.log('‚ö†Ô∏è Sistema de diagn√≥stico n√£o est√° dispon√≠vel');
            }
        };

        // Add error handling
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            if (window.notificationManager) {
                window.notificationManager.show(
                    'Erro do Sistema', 
                    'Ocorreu um erro inesperado. Verifique o console para detalhes.', 
                    'error'
                );
            }
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            if (window.notificationManager) {
                window.notificationManager.show(
                    'Erro de Conex√£o', 
                    'Problema de conectividade detectado.', 
                    'warning'
                );
            }
        });
    </script>
</body>
</html>